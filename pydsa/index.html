<!DOCTYPE html>
<html>
  <head>
    <title>Python Cookbook for Scientific Data Analysis</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.39" />
<title>Drop Shape analysis using pyDSA (image) :: Python Cookbook for Scientific Data Analysis</title>
<link rel="shortcut icon" href="/Python-cookbook/images/favicon.png" type="image/x-icon" />
<link href="/Python-cookbook/css/font-awesome.min.css" rel="stylesheet">
<link href="/Python-cookbook/css/nucleus.css" rel="stylesheet">
<link href="/Python-cookbook/theme-flex/style.css" rel="stylesheet">

<link rel="stylesheet" href="/Python-cookbook/css/bootstrap.min.css">
<script src="/Python-cookbook/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "https:\/\/gabylaunay.github.io\/Python-cookbook\/";
</script>
<meta name="description" content="Tutorial for drop shape analysis using pyDSA on a single image.">


    
  </head>
  <body data-url="/Python-cookbook/pydsa/">
    
      <header>
  <div class="logo">
    
	
  
    <a class="baselink" href="https://gabylaunay.github.io/Python-cookbook/">Python Cookbook for Scientific Data Analysis</a>
  

  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/Python-cookbook/" class="dd-item">
          <a href="/Python-cookbook/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/Python-cookbook/image-analysis/" class="dd-item
        ">
      <div>
      <a href="/Python-cookbook/image-analysis/">Drop Shape analysis using Python</a>
      </div>
    </li>
    <li data-nav-id="/Python-cookbook/pydsa/" class="dd-item parent active
        ">
      <div>
      <a href="/Python-cookbook/pydsa/">Drop Shape analysis using pyDSA (image)</a>
      </div>
    </li>
    <li data-nav-id="/Python-cookbook/pydsa_video/" class="dd-item
        ">
      <div>
      <a href="/Python-cookbook/pydsa_video/">Drop Shape analysis using pyDSA (video)</a>
      </div>
    </li>
    <li data-nav-id="/Python-cookbook/import-data/" class="dd-item
        ">
      <div>
      <a href="/Python-cookbook/import-data/">Importing Data</a>
      </div>
    </li>
    <li data-nav-id="/Python-cookbook/publication_quality_plots/" class="dd-item
        ">
      <div>
      <a href="/Python-cookbook/publication_quality_plots/">Publication-quality plots</a>
      </div>
    </li>




    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/Python-cookbook/image-analysis/" >
   Drop Shape analysis using Python</option>
    <option value="/Python-cookbook/pydsa/"  selected>
   Drop Shape analysis using pyDSA (image)</option> 
  
    <option value="/Python-cookbook/pydsa_video/" >
   Drop Shape analysis using pyDSA (video)</option>
    <option value="/Python-cookbook/import-data/" >
   Importing Data</option>
    <option value="/Python-cookbook/publication_quality_plots/" >
   Publication-quality plots</option>



        </select>
      </center>
    </div>
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="Search...">
        </div>
        <script type="text/javascript" src="/Python-cookbook/js/lunr.min.js"></script>
        <script type="text/javascript" src="/Python-cookbook/js/auto-complete.js"></script>
        <link href="/Python-cookbook/css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "https:\/\/gabylaunay.github.io\/Python-cookbook\/";
          
        </script>
        <script type="text/javascript" src="/Python-cookbook/js/search.js"></script>
      </div>
    

    <h1>Drop Shape analysis using pyDSA (image)</h1>
    
    
    



<p><div class="notices tip" ><p>You can get the python script detailled in this page here: <a href="files/script.py">script.py</a>.</p>

<p>And an archive containing the script and the data here: <a href="files/archive.tar.gz">archive.tar.gz</a>, <a href="files/archive.zip">archive.zip</a>.</p>
</div>

<a href="https://github.com/gabylaunay/pyDSA">pyDSA</a> is a python3 package for Drop Shape Analysis.</p>

<h2 id="installing-pydsa">Installing pyDSA</h2>

<h3 id="dependencies">Dependencies</h3>

<p>You will first need to install <a href="https://framagit.org/gabylaunay/IMTreatment">IMTreatment</a> by downloading the package <a href="https://framagit.org/gabylaunay/IMTreatment/repository/master/archive.zip">here</a>, extracting it and installing it with:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 setup.py install</code></pre></div>
<p>pyDSA also use <a href="https://opencv.org">OpenCV</a> for edge detection, so you will need it installed as well.</p>

<h3 id="install-pydsa">Install pyDSA</h3>

<p>Download the sources <a href="https://github.com/gabylaunay/pyDSA/archive/master.zip">here</a>, extract, and install them:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 setup.py install</code></pre></div>
<p>pyDSA have some dependencies (matplotlib, scipy, numpy, &hellip;) that should be installed automatically.</p>

<h2 id="importing-an-image">Importing an image</h2>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">pyDSA</span> <span style="color:#007020;font-weight:bold">as</span> <span style="color:#0e84b5;font-weight:bold">dsa</span>
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">matplotlib.pyplot</span> <span style="color:#007020;font-weight:bold">as</span> <span style="color:#0e84b5;font-weight:bold">plt</span>

<span style="color:#60a0b0;font-style:italic"># Import an image</span>
im <span style="color:#666">=</span> dsa<span style="color:#666">.</span>import_from_image(<span style="color:#4070a0">&#39;data/image.bmp&#39;</span>, dx<span style="color:#666">=</span><span style="color:#40a070">1</span><span style="color:#666">/</span><span style="color:#40a070">120</span>, dy<span style="color:#666">=</span><span style="color:#40a070">1</span><span style="color:#666">/</span><span style="color:#40a070">120</span>, unit_x<span style="color:#666">=</span><span style="color:#4070a0">&#39;mm&#39;</span>, unit_y<span style="color:#666">=</span><span style="color:#4070a0">&#39;mm&#39;</span>)

<span style="color:#60a0b0;font-style:italic"># Display it</span>
plt<span style="color:#666">.</span>figure()
im<span style="color:#666">.</span>display()
plt<span style="color:#666">.</span>show()</code></pre></div>
<p><img src="pydsa_files/pydsa_2_0.png" alt="png" /></p>

<h2 id="scaling">Scaling</h2>

<p>Here we scaled the image during the import (using the <code>dx</code> and <code>dy</code> parameters),
but you can also scale the image afterwards, using the <code>im.scale_interactive()</code> interactive function.</p>

<p>This function ask you to select two points on the image and to input the real distance (in mm for example) separating them.
It then scale the image accordingly.</p>

<h2 id="focusing-on-the-drop">Focusing on the drop</h2>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">im<span style="color:#666">.</span>crop(intervx<span style="color:#666">=</span>[<span style="color:#40a070">1.5</span>, <span style="color:#40a070">5</span>], intervy<span style="color:#666">=</span>[<span style="color:#40a070">1</span>, <span style="color:#40a070">3</span>], inplace<span style="color:#666">=</span>True)

<span style="color:#60a0b0;font-style:italic"># Display</span>
plt<span style="color:#666">.</span>figure()
im<span style="color:#666">.</span>display()
plt<span style="color:#666">.</span>show()</code></pre></div>
<p><img src="pydsa_files/pydsa_5_0.png" alt="png" /></p>

<h2 id="setting-the-baseline">Setting the baseline</h2>

<p>pyDSA provides an interactive function <code>im.choose_baseline()</code> to interactively set the baseline.
It will display the drop image and ask you to put baseline points by clicking on the image.</p>

<p>Here, we are gonna use the non-interactive function <code>im.set_baseline()</code> to set the baseline.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">im<span style="color:#666">.</span>set_baseline(pt1<span style="color:#666">=</span>[<span style="color:#40a070">2</span>, <span style="color:#40a070">1.61</span>], pt2<span style="color:#666">=</span>[<span style="color:#40a070">4.5</span>, <span style="color:#40a070">1.61</span>])

<span style="color:#60a0b0;font-style:italic"># DisplayF</span>
plt<span style="color:#666">.</span>figure()
im<span style="color:#666">.</span>display()
plt<span style="color:#666">.</span>show()</code></pre></div>
<p><img src="pydsa_files/pydsa_7_0.png" alt="png" /></p>

<p>The baseline is automatically displayed as a green line on the drop image.</p>

<h2 id="detecting-the-edges">Detecting the edges</h2>

<p>The drop edge is detected using the <a href="https://en.wikipedia.org/wiki/Canny_edge_detector">Canny edge detection</a> algorithm from OpenCV.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">edge <span style="color:#666">=</span> im<span style="color:#666">.</span>edge_detection()

<span style="color:#60a0b0;font-style:italic"># Display the edge</span>
plt<span style="color:#666">.</span>figure()
edge<span style="color:#666">.</span>display()
plt<span style="color:#666">.</span>show()</code></pre></div>
<p><img src="pydsa_files/pydsa_10_0.png" alt="png" /></p>

<p>If the edge detection is not good enough, the <code>edge_detection</code> function provides several optional arguments that can help you get the edges you want.
Please refer to the inline documentation of this function if you want to know more about this.</p>

<h2 id="fitting-the-edge">Fitting the edge</h2>

<p>Computing the contact angles will necessitates the edges to be fitted by a curve of some kind.
pyDSA uses a spline fitting to achieve this.</p>

<p>The parameter <code>s</code> can be tuned to adapt the fitting:
small values of <code>s</code> means a more accurate fitting, and bigger values of <code>s</code> a smoother fitting.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">edge<span style="color:#666">.</span>fit(s<span style="color:#666">=</span><span style="color:#40a070">0.0005</span>)

<span style="color:#60a0b0;font-style:italic"># Display the edge</span>
plt<span style="color:#666">.</span>figure()
edge<span style="color:#666">.</span>display()
plt<span style="color:#666">.</span>show()</code></pre></div>
<p><img src="pydsa_files/pydsa_13_0.png" alt="png" /></p>

<p>The edge fitting is displayed in orange.</p>

<h2 id="detecting-the-triple-points">Detecting the triple points</h2>

<p>In the case of a SLIPS surface, pyDSA can detect the triple points of contact between the oil, water and air (e.g. the ridge top).
This is done by detecting the point of inflexion of the edge line.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">edge<span style="color:#666">.</span>detect_triple_points()

<span style="color:#60a0b0;font-style:italic"># Display the edge</span>
plt<span style="color:#666">.</span>figure()
edge<span style="color:#666">.</span>display()
plt<span style="color:#666">.</span>show()</code></pre></div>
<p><img src="pydsa_files/pydsa_16_0.png" alt="png" /></p>

<p>The triple points are displayed in purple.</p>

<h2 id="computing-the-contact-angles">Computing the contact angles</h2>

<p>pyDSA uses the edge fitting to compute two kind of contact angles:
- the contact angles between the drop and the baseline.
- the apparent contact angles at the triple point (if a triple point is present).</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">edge<span style="color:#666">.</span>compute_contact_angle()
<span style="color:#007020;font-weight:bold">print</span>(<span style="color:#4070a0">&#39;Contact angles: {}&#39;</span><span style="color:#666">.</span>format(edge<span style="color:#666">.</span>thetas))
<span style="color:#007020;font-weight:bold">print</span>(<span style="color:#4070a0">&#39;Triple point angles: {}&#39;</span><span style="color:#666">.</span>format(edge<span style="color:#666">.</span>thetas_triple))

<span style="color:#60a0b0;font-style:italic"># Display the edge</span>
fig, axs <span style="color:#666">=</span> plt<span style="color:#666">.</span>subplots(<span style="color:#40a070">1</span>, <span style="color:#40a070">2</span>, figsize<span style="color:#666">=</span>(<span style="color:#40a070">10</span>, <span style="color:#40a070">4</span>))
plt<span style="color:#666">.</span>sca(axs[<span style="color:#40a070">0</span>])
edge<span style="color:#666">.</span>display()
plt<span style="color:#666">.</span>axis(<span style="color:#4070a0">&#39;equal&#39;</span>)
plt<span style="color:#666">.</span>ylim(<span style="color:#40a070">1.5</span>, <span style="color:#40a070">3</span>)
<span style="color:#60a0b0;font-style:italic"># Zoom</span>
plt<span style="color:#666">.</span>sca(axs[<span style="color:#40a070">1</span>])
edge<span style="color:#666">.</span>display()
plt<span style="color:#666">.</span>axis(<span style="color:#4070a0">&#39;equal&#39;</span>)
plt<span style="color:#666">.</span>ylim(<span style="color:#40a070">1.5</span>, <span style="color:#40a070">2</span>)
plt<span style="color:#666">.</span>xlim(<span style="color:#40a070">2</span>, <span style="color:#40a070">2.3</span>)
plt<span style="color:#666">.</span>show()</code></pre></div>
<pre><code>Contact angles: [48.90734602702736, 126.40314516490614]
Triple point angles: [81.4670191340014, 96.86878969719106]
</code></pre>

<p><img src="pydsa_files/pydsa_19_1.png" alt="png" /></p>

<h1 id="full-script">Full script</h1>

<p>The whole process can be concentrated in a few lines of code, that allow to get from the drop image to the contact angles:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">pyDSA</span> <span style="color:#007020;font-weight:bold">as</span> <span style="color:#0e84b5;font-weight:bold">dsa</span>
<span style="color:#007020;font-weight:bold">import</span> <span style="color:#0e84b5;font-weight:bold">matplotlib.pyplot</span> <span style="color:#007020;font-weight:bold">as</span> <span style="color:#0e84b5;font-weight:bold">plt</span>

im <span style="color:#666">=</span> dsa<span style="color:#666">.</span>import_from_image(<span style="color:#4070a0">&#39;data/image.bmp&#39;</span>, dx<span style="color:#666">=</span><span style="color:#40a070">1</span><span style="color:#666">/</span><span style="color:#40a070">120</span>, dy<span style="color:#666">=</span><span style="color:#40a070">1</span><span style="color:#666">/</span><span style="color:#40a070">120</span>, unit_x<span style="color:#666">=</span><span style="color:#4070a0">&#39;mm&#39;</span>, unit_y<span style="color:#666">=</span><span style="color:#4070a0">&#39;mm&#39;</span>)
im<span style="color:#666">.</span>crop(intervx<span style="color:#666">=</span>[<span style="color:#40a070">1.5</span>, <span style="color:#40a070">5</span>], intervy<span style="color:#666">=</span>[<span style="color:#40a070">1</span>, <span style="color:#40a070">3</span>], inplace<span style="color:#666">=</span>True)
im<span style="color:#666">.</span>set_baseline([<span style="color:#40a070">2</span>, <span style="color:#40a070">1.61</span>], [<span style="color:#40a070">4.5</span>, <span style="color:#40a070">1.61</span>])
edge <span style="color:#666">=</span> im<span style="color:#666">.</span>edge_detection()
edge<span style="color:#666">.</span>fit(s<span style="color:#666">=</span><span style="color:#40a070">0.0005</span>)
edge<span style="color:#666">.</span>detect_triple_points()
edge<span style="color:#666">.</span>compute_contact_angle()

<span style="color:#60a0b0;font-style:italic"># Display the edge</span>
plt<span style="color:#666">.</span>figure(figsize<span style="color:#666">=</span>(<span style="color:#40a070">20</span>, <span style="color:#40a070">8</span>))
edge<span style="color:#666">.</span>display()
im<span style="color:#666">.</span>display()
plt<span style="color:#666">.</span>show()</code></pre></div>
<p><img src="pydsa_files/pydsa_21_0.png" alt="png" /></p>

<h1 id="dealing-with-videos">Dealing with videos</h1>

<p>pyDSA can directly import videos and automatically analyze them in batch.
This is the subject of the next tutorial, available <a href="../pydsa_video/index.html">here</a>.</p>

<h1 id="how-does-it-works">How does it works ?</h1>

<p>If you want to know more about how pyDSA works, you can take a look at the <a href="../image-analysis/index.html">drop shape analysis tutorial</a>, or go through the code (on your machine, or <a href="https://github.com/gabylaunay/pyDSA">here</a>).</p>



    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/Python-cookbook/image-analysis/" title="Drop Shape analysis using Python"> <i class="fa fa-chevron-left"></i><label>Drop Shape analysis using Python</label></a>
    <a class="nav nav-next" href="/Python-cookbook/pydsa_video/" title="Drop Shape analysis using pyDSA (video)" style="margin-right: 0px;"><label>Drop Shape analysis using pyDSA (video)</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

  

    <div class="github-link">
      <a href="pydsa/_index.md" target="blank"><i class="fa fa-code-fork"></i>
        Improve this page</a>
    </div>
  </div>


	<div>


  
    
  



	</div>
</footer>

<script src="/Python-cookbook/js/clipboard.min.js"></script>

<link href="/Python-cookbook/css/featherlight.min.css" rel="stylesheet">
<script src="/Python-cookbook/js/featherlight.min.js"></script>



<script src="/Python-cookbook/theme-flex/script.js"></script>

    

    
    

    
  </body>
</html>